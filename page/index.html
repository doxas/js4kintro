<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="description" content="webgl+glsl+javascript 4k intro demo compo">
	<meta name="keywords" content="webgl,glsl,javascript,4k,4k intro,demo,democompo">
	
	<link rel="shortcut icon" href="image/favicon.ico" type="image/x-icon">
	<link href='http://fonts.googleapis.com/css?family=Play:700' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" href="style.css" type="text/css">
	
	<script type="text/javascript" src="script.js"></script>
	
	<title>javascript 4k intro</title>
</head>
<body>
	<div id="wrap">
		<div id="screen">
			<canvas id="canvas"></canvas>
			<div id="menu"><a href="javascript:void(0);" id="menuButton">run</a></div>
		</div>
		<div id="content">
			<header>
				<h1>js <span style="color: dodgerblue">4</span>k intro</h1>
				<p><img src="image/logo.png" width="64" height="64" alt=""></p>
			</header>
			<section id="section">
				<h2>entries in the 2014</h2>
				<div class="entry">
					<h3>hearts</h3>
					<p><img id="image000" src="image/heart.jpg" width="250" height="250" alt=""></p>
					<ul>
						<li>size: 1922 bytes</li>
						<li>source: <a href="http://goo.gl/VjuKaF" target="_blank">preview</a></li>
						<li>author: <a href="https://twitter.com/h_doxas" target="_blank">@h_doxas</a></li>
					</ul>
				</div>
				<div class="entry">
					<h3>planets</h3>
					<p><img id="image001" src="image/planets.jpg" width="250" height="250" alt=""></p>
					<ul>
						<li>size: 4034 bytes</li>
						<li>source: <a href="http://goo.gl/bWr2me" target="_blank">preview</a></li>
						<li>author: <a href="https://twitter.com/g200kg" target="_blank">@g200kg</a></li>
					</ul>
				</div>
				<div class="entry">
					<h3>anpanman</h3>
					<p><img id="image002" src="image/anpan.jpg" width="250" height="250" alt=""></p>
					<ul>
						<li>size: 4029 bytes</li>
						<li>source: <a href="http://goo.gl/tje46d" target="_blank">preview</a></li>
						<li>author: <a href="https://twitter.com/h_doxas" target="_blank">@h_doxas</a></li>
					</ul>
				</div>
				<h2>about</h2>
				<p>HTML + javaScript + glsl demo under 4k.</p>
				<p>Let's enjoy => <a href="http://jp.wgld.org/js4kintro/editor/">GLSL online editor</a></p>
			</section>
			<footer>
				<p>copyright (c) js4kintro all rights reserved</p>
			</footer>
		</div>
	</div>
	<input id="targetSource" type="hidden" value="0">
	<script id="000" type="x-shader/x-fragment">precision mediump float;
uniform float t; // time
uniform vec2  r; // resolution

vec3 hsv(float h, float s, float v){
	vec4 t = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
	vec3 p = abs(fract(vec3(h) + t.xyz) * 6.0 - vec3(t.w));
	return v * mix(vec3(t.x), clamp(p - vec3(t.x), 0.0, 1.0), s);
}

void main(void){
	vec2 s = vec2(sin(t * 0.333), cos(t) * 0.5);
	vec2 q = ((gl_FragCoord.xy * 2.0 - r) / min(r.x, r.y) + s) * 10.0;
	vec2 p = mod(q, 4.0) - 2.0;
	float f = p.x * p.x * p.y * p.y * p.y;
	float g = p.x * p.x + p.y * p.y - 1.0;
	float h = g * g * g;
	float i = 1.0;
	if(f < h){i = 0.0;}
	vec3 dest = hsv(sin(t), 0.75, 0.75);
	gl_FragColor = vec4(dest * i, 1.0);
}</script>
	<script id="001" type="x-shader/x-fragment">precision mediump float;
uniform float t;
uniform vec2  r;
vec3 hsv(float h,float s,float v){
	vec4 t=vec4(1.,2./3.,1./3.,3.);
	vec3 p=abs(fract(vec3(h)+t.xyz)*6.-vec3(t.w));
	return v*mix(vec3(t.x),clamp(p-vec3(t.x),0.,1.),s);
}
float psin(float x){
	return sin(x)*.5+.5;
}
float rnd(vec2 p){
    return fract((sin(p.x)*sin(p.y))*1234.);
}
vec2 orbit(float s,float p,float w,float y) {
	return vec2(w*cos(t*s+p),w*.3*sin(t*s)+y);
}
vec3 planet(vec2 px,vec2 p,float r,float f,vec3 c){
	vec2 lp=(px-p)/r;
	float l=1.-length(lp);
	vec3 p3=vec3(lp,sqrt(1.-lp.x*lp.x-lp.y*lp.y));
	float z=dot(vec3(-.577,.577,.577),p3);
	float zz=max(pow(dot(normalize(vec3(-.5,.5,1.)),p3),26.),.0001);
	if(l>0.){
		float a=psin(t*.1)*.4;
		float b=a+(1.-a)*z;
		c+=vec3(cos(2.3*cos(t/r*.015+p3.z*11.)+1.2*sin(p3.y*3.-p3.x*5.1))*.1
			,cos(.5*cos(t/r*.08+p3.z*2.1)+1.5*sin(t+p3.z*4.+p3.y*f*sin(p3.z*4.)-p3.x*5.1))*.2
			,cos(cos(t/r*.31+p3.z*2.1)+sin(lp.y*3.-p3.x*5.1))*.4);
		c*=b;
		return c+(1.-c)*zz;
	}
	return vec3(0);
}
vec3 planet2(vec2 px,vec2 p,float r1,float r2,float f,vec3 c,float th){
	vec2 p0=px-p, lp1=p0/r1;
	lp1*=mat2(cos(th),sin(th),-sin(th),cos(th));
	vec2 lp2=(p0)/r2;
	float l1=1.-(lp1.x*lp1.x+lp1.y*lp1.y*20.);
	float l2=1.-length(lp2);
	if(p0.y>0.&&l2>0.)
		return planet(px,p,r2,f,c);
	if(l1>0.&&l1<.6)
		return c*vec3(psin(l1*22.)*.2+.5,psin(l1*31.)*.4+.5,psin(l1*18.)*.2+.5);
	if(l2>0.)
		return planet(px,p,r2,f,c);
	return vec3(0);
}
vec3 pt(int i,vec2 p1,float sr,float f){
	float r=rnd(p1), vn=r/sr;
	return hsv(fract(vn*30.)*.7-.1,.2,f*pow((3.-abs(float(i)))*.25,2.)*vn);
}
vec3 star(vec2 p,float s,float f){
	vec2 p0=gl_FragCoord.xy+vec2(floor((t+100.)*s),0);
	float sr=(psin(t*.1))*.003;
	for(int i=-2;i<3;++i){
		vec2 p1=p0+vec2(i,0.);
		if(rnd(p1)<sr)
			return pt(i,p1,sr,f);
	}
	for(int i=-2;i<3;++i){
		vec2 p1=p0+vec2(0.,i);
		if(rnd(p1)<sr)
			return pt(i,p1,sr,f);
	}
	return vec3(0);
}
vec3 stars(vec2 p){
	float s=100.,f=2.;
	for(int i=0;i<6;++i){
		vec3 r=star(p,s,f);
		s*=.9; f*=.95;
		if(r.x!=0.)
			return r;
	}
	return vec3(0);
}
void main(void){
	vec2 p=(gl_FragCoord.xy*2.-r)/r;
	vec3 c=planet(p,orbit(.08,0.,1.1,-2.6),2.1,11.,vec3(.8,.4,0.));
	if(c.x==0.){
		c=planet(p,orbit(.05,3.3,.6,0.),.23,1.,vec3(.3,.3,1.));
		if(c.x==0.){
			c=planet2(p,orbit(.082,.5,.9,.35),.2,.08,12.1,vec3(.6,.7,.8),-.2);
			if(c.x==0.){
				c=planet(p,orbit(.18,1.3,.7,.6),.06,1.,vec3(1.,.3,.3));
				if(c.x==0.){
					c=planet2(p,orbit(.056,0.07,1.5,.5),.09,.04,1.,vec3(.6,.8,.3),.1);
					if(c.x==0.){
						c=stars(p);
						float d=pow(psin(t*.24),13.)*pow(fract((cos(t*.1+p.x*sin(t)*4.)*sin(t)+tan(t*.21+p.y*cos(t)*3.5)*sin(t*.7))*(sin(t*.1)*10.)),(sin(t)+2.)*20.);
						c+=vec3(0.,d*pow(psin(t*.05),4.0),d);
					}
				}
			}
		}
	}
	gl_FragColor=vec4(c,1.);
}</script>
	<script id="002" type="x-shader/x-fragment">precision mediump float;uniform float t;uniform vec2 r;void main(){vec2 p=(gl_FragCoord.xy*2.-r)/max(r.x,r.y);float u=abs(sin((atan(p.y,p.x)-length(p)+t)*10.)*.5)+.2;float t=.01/abs(u-length(p));gl_FragColor=vec4(vec3(t),1.);}</script>
</body>
</html>
