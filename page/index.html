<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="description" content="webgl+glsl+javascript 4k intro demo compo">
	<meta name="keywords" content="webgl,glsl,javascript,4k,4k intro,demo,democompo">
	
	<link rel="shortcut icon" href="image/favicon.ico" type="image/x-icon">
	<link href='http://fonts.googleapis.com/css?family=Play:700' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" href="style.css" type="text/css">
	
	<script type="text/javascript" src="script.js"></script>
	
	<title>javascript 4k intro</title>
</head>
<body>
	<div id="fb-root"></div>
	<script>(function(d, s, id) {
	  var js, fjs = d.getElementsByTagName(s)[0];
	  if (d.getElementById(id)) return;
	  js = d.createElement(s); js.id = id;
	  js.src = "//connect.facebook.net/ja_JP/sdk.js#xfbml=1&appId=1526484404235143&version=v2.0";
	  fjs.parentNode.insertBefore(js, fjs);
	}(document, 'script', 'facebook-jssdk'));</script>
	<div id="wrap">
		<div id="screen">
			<canvas id="canvas"></canvas>
			<div id="menu"><a href="javascript:void(0);" id="menuButton">run</a></div>
		</div>
		<div id="content">
			<header>
				<h1>js <span style="color: dodgerblue">4</span>k intro</h1>
				<p><img src="image/logo.png" width="64" height="64" alt=""></p>
			</header>
			<section id="section">
				<h2>entries in the 2014</h2>
				<div class="entry">
					<h3>hearts</h3>
					<p><img id="image000" src="image/heart.jpg" width="250" height="250" alt=""></p>
					<ul>
						<li>size: 1922 bytes</li>
						<li>source: <a href="http://goo.gl/VjuKaF" target="_blank">preview</a></li>
						<li>author: <a href="https://twitter.com/h_doxas" target="_blank">@h_doxas</a></li>
					</ul>
				</div>
				<div class="entry">
					<h3>planets</h3>
					<p><img id="image001" src="image/planets.jpg" width="250" height="250" alt=""></p>
					<ul>
						<li>size: 4034 bytes</li>
						<li>source: <a href="http://goo.gl/bWr2me" target="_blank">preview</a></li>
						<li>author: <a href="https://twitter.com/g200kg" target="_blank">@g200kg</a></li>
					</ul>
				</div>
				<div class="entry">
					<h3>anpanman</h3>
					<p><img id="image002" src="image/anpan.jpg" width="250" height="250" alt=""></p>
					<ul>
						<li>size: 4029 bytes</li>
						<li>source: <a href="http://goo.gl/tje46d" target="_blank">preview</a></li>
						<li>author: <a href="https://twitter.com/h_doxas" target="_blank">@h_doxas</a></li>
					</ul>
				</div>
				<div class="entry">
					<h3>mario shader</h3>
					<p><img id="image003" src="image/mario.jpg" width="250" height="250" alt=""></p>
					<ul>
						<li>size: 2913 bytes</li>
						<li>source: <a href="http://goo.gl/UOMRXg" target="_blank">preview</a></li>
						<li>author: <a href="https://twitter.com/cx20" target="_blank">@cx20</a></li>
					</ul>
				</div>
				<div class="entry">
					<h3>water drop</h3>
					<p><img id="image004" src="image/water.jpg" width="250" height="250" alt=""></p>
					<ul>
						<li>size: 2002 bytes</li>
						<li>source: <a href="http://goo.gl/tM82gx" target="_blank">preview</a></li>
						<li>author: <a href="https://twitter.com/yuza_ja" target="_blank">@yuza_ja</a></li>
					</ul>
				</div>
				<div class="entry">
					<h3>GLSL Clock</h3>
					<p><img id="image005" src="image/glslclock.jpg" width="250" height="250" alt=""></p>
					<ul>
						<li>size: 4052 bytes</li>
						<li>source: <a href="http://goo.gl/Fma9Cx" target="_blank">preview</a></li>
						<li>author: k_ryo</li>
					</ul>
				</div>
				<div class="entry">
					<h3>dancing sphere</h3>
					<p><img id="image006" src="image/dancingsphere.jpg" width="250" height="250" alt=""></p>
					<ul>
						<li>size: 3935 bytes</li>
						<li>source: <a href="http://goo.gl/xI0VoG" target="_blank">preview</a></li>
						<li>author: <a href="https://twitter.com/yuza_ja" target="_blank">@yuza_ja</a></li>
					</ul>
				</div>
				<h2>share</h2>
				<div id="social">
					<a href="https://twitter.com/share" class="twitter-share-button" data-url="http://jp.wgld.org/js4kintro/" data-hashtags="js4kintro">Tweet</a>
					<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
					<a href="http://b.hatena.ne.jp/entry/http://jp.wgld.org/js4kintro/" class="hatena-bookmark-button" data-hatena-bookmark-title="js 4k intro" data-hatena-bookmark-layout="standard-balloon" data-hatena-bookmark-lang="en" title="このエントリーをはてなブックマークに追加">
						<img src="https://b.st-hatena.com/images/entry-button/button-only@2x.png" alt="このエントリーをはてなブックマークに追加" width="20" height="20" style="border: none;">
					</a>
					<script type="text/javascript" src="https://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script>
					<div class="fb-like" data-href="http://jp.wgld.org/js4kintro/" data-layout="button_count" data-action="like" data-show-faces="false" data-share="false">
					</div>
					<a data-pocket-label="pocket" data-pocket-count="horizontal" class="pocket-btn" data-lang="en"></a>
					<script type="text/javascript">!function(d,i){if(!d.getElementById(i)){var j=d.createElement("script");j.id=i;j.src="https://widgets.getpocket.com/v1/j/btn.js?v=1";var w=d.getElementById(i);d.body.appendChild(j);}}(document,"pocket-btn-js");</script>
				</div>
				<h2>about</h2>
				<p>HTML + javaScript + glsl demo under 4k.</p>
				<p>Let's enjoy => <a href="http://jp.wgld.org/js4kintro/editor/">GLSL online editor</a></p>
			</section>
			<footer>
				<p>copyright (c) js4kintro all rights reserved</p>
			</footer>
		</div>
	</div>
	<input id="targetSource" type="hidden" value="0">
	<script id="000" type="x-shader/x-fragment">precision mediump float;
uniform float t; // time
uniform vec2  r; // resolution

vec3 hsv(float h, float s, float v){
	vec4 t = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
	vec3 p = abs(fract(vec3(h) + t.xyz) * 6.0 - vec3(t.w));
	return v * mix(vec3(t.x), clamp(p - vec3(t.x), 0.0, 1.0), s);
}

void main(void){
	vec2 s = vec2(sin(t * 0.333), cos(t) * 0.5);
	vec2 q = ((gl_FragCoord.xy * 2.0 - r) / min(r.x, r.y) + s) * 10.0;
	vec2 p = mod(q, 4.0) - 2.0;
	float f = p.x * p.x * p.y * p.y * p.y;
	float g = p.x * p.x + p.y * p.y - 1.0;
	float h = g * g * g;
	float i = 1.0;
	if(f < h){i = 0.0;}
	vec3 dest = hsv(sin(t), 0.75, 0.75);
	gl_FragColor = vec4(dest * i, 1.0);
}</script>
	<script id="001" type="x-shader/x-fragment">precision mediump float;
uniform float t;
uniform vec2  r;
vec3 hsv(float h,float s,float v){
	vec4 t=vec4(1.,2./3.,1./3.,3.);
	vec3 p=abs(fract(vec3(h)+t.xyz)*6.-vec3(t.w));
	return v*mix(vec3(t.x),clamp(p-vec3(t.x),0.,1.),s);
}
float psin(float x){
	return sin(x)*.5+.5;
}
float rnd(vec2 p){
    return fract((sin(p.x)*sin(p.y))*1234.);
}
vec2 orbit(float s,float p,float w,float y) {
	return vec2(w*cos(t*s+p),w*.3*sin(t*s)+y);
}
vec3 planet(vec2 px,vec2 p,float r,float f,vec3 c){
	vec2 lp=(px-p)/r;
	float l=1.-length(lp);
	vec3 p3=vec3(lp,sqrt(1.-lp.x*lp.x-lp.y*lp.y));
	float z=dot(vec3(-.577,.577,.577),p3);
	float zz=max(pow(dot(normalize(vec3(-.5,.5,1.)),p3),26.),.0001);
	if(l>0.){
		float a=psin(t*.1)*.4;
		float b=a+(1.-a)*z;
		c+=vec3(cos(2.3*cos(t/r*.015+p3.z*11.)+1.2*sin(p3.y*3.-p3.x*5.1))*.1
			,cos(.5*cos(t/r*.08+p3.z*2.1)+1.5*sin(t+p3.z*4.+p3.y*f*sin(p3.z*4.)-p3.x*5.1))*.2
			,cos(cos(t/r*.31+p3.z*2.1)+sin(lp.y*3.-p3.x*5.1))*.4);
		c*=b;
		return c+(1.-c)*zz;
	}
	return vec3(0);
}
vec3 planet2(vec2 px,vec2 p,float r1,float r2,float f,vec3 c,float th){
	vec2 p0=px-p, lp1=p0/r1;
	lp1*=mat2(cos(th),sin(th),-sin(th),cos(th));
	vec2 lp2=(p0)/r2;
	float l1=1.-(lp1.x*lp1.x+lp1.y*lp1.y*20.);
	float l2=1.-length(lp2);
	if(p0.y>0.&&l2>0.)
		return planet(px,p,r2,f,c);
	if(l1>0.&&l1<.6)
		return c*vec3(psin(l1*22.)*.2+.5,psin(l1*31.)*.4+.5,psin(l1*18.)*.2+.5);
	if(l2>0.)
		return planet(px,p,r2,f,c);
	return vec3(0);
}
vec3 pt(int i,vec2 p1,float sr,float f){
	float r=rnd(p1), vn=r/sr;
	return hsv(fract(vn*30.)*.7-.1,.2,f*pow((3.-abs(float(i)))*.25,2.)*vn);
}
vec3 star(vec2 p,float s,float f){
	vec2 p0=gl_FragCoord.xy+vec2(floor((t+100.)*s),0);
	float sr=(psin(t*.1))*.003;
	for(int i=-2;i<3;++i){
		vec2 p1=p0+vec2(i,0.);
		if(rnd(p1)<sr)
			return pt(i,p1,sr,f);
	}
	for(int i=-2;i<3;++i){
		vec2 p1=p0+vec2(0.,i);
		if(rnd(p1)<sr)
			return pt(i,p1,sr,f);
	}
	return vec3(0);
}
vec3 stars(vec2 p){
	float s=100.,f=2.;
	for(int i=0;i<6;++i){
		vec3 r=star(p,s,f);
		s*=.9; f*=.95;
		if(r.x!=0.)
			return r;
	}
	return vec3(0);
}
void main(void){
	vec2 p=(gl_FragCoord.xy*2.-r)/r;
	vec3 c=planet(p,orbit(.08,0.,1.1,-2.6),2.1,11.,vec3(.8,.4,0.));
	if(c.x==0.){
		c=planet(p,orbit(.05,3.3,.6,0.),.23,1.,vec3(.3,.3,1.));
		if(c.x==0.){
			c=planet2(p,orbit(.082,.5,.9,.35),.2,.08,12.1,vec3(.6,.7,.8),-.2);
			if(c.x==0.){
				c=planet(p,orbit(.18,1.3,.7,.6),.06,1.,vec3(1.,.3,.3));
				if(c.x==0.){
					c=planet2(p,orbit(.056,0.07,1.5,.5),.09,.04,1.,vec3(.6,.8,.3),.1);
					if(c.x==0.){
						c=stars(p);
						float d=pow(psin(t*.24),13.)*pow(fract((cos(t*.1+p.x*sin(t)*4.)*sin(t)+tan(t*.21+p.y*cos(t)*3.5)*sin(t*.7))*(sin(t*.1)*10.)),(sin(t)+2.)*20.);
						c+=vec3(0.,d*pow(psin(t*.05),4.0),d);
					}
				}
			}
		}
	}
	gl_FragColor=vec4(c,1.);
}</script>
	<script id="002" type="x-shader/x-fragment">precision mediump float;
uniform float t;
uniform vec2  r;
const float PI = 3.1415926;
const vec3 lightColor = vec3(.95, .95, .5);
const vec3 backColor = vec3(.95, .25, .25);
const vec3 faceColor = vec3(.95, .75, .5);
const vec3 noseColor = vec3(.95, .25, .25);
const vec3 cheekColor = vec3(1., .55, .25);
const vec3 eyesColor = vec3(.15, .05, .05);
const vec3 highlight = vec3(.95, .95, .95);
const vec3 lineColor = vec3(.3, .2, .2);
void circle(vec2 p, vec2 offset, float size, vec3 color, inout vec3 i){
	float l = length(p - offset);
	if(l < size){i = color;}
}
void ellipse(vec2 p, vec2 offset, vec2 prop, float size, vec3 color, inout vec3 i){
	vec2 q = (p - offset) / prop;
	if(length(q) < size){i = color;}
}
void circleLine(vec2 p, vec2 offset, float iSize, float oSize, vec3 color, inout vec3 i){
	vec2 q = p - offset;
	float l = length(q);
	if(l > iSize && l < oSize){i = color;}
}
void arcLine(vec2 p, vec2 offset, float iSize, float oSize, float rad, float height, vec3 color, inout vec3 i){
	float s = sin(rad);
	float c = cos(rad);
	vec2 q = (p - offset) * mat2(c, -s, s, c);
	float l = length(q);
	if(l > iSize && l < oSize && q.y > height){i = color;}
}
void rect(vec2 p, vec2 offset, float size, vec3 color, inout vec3 i){
	vec2 q = (p - offset) / size;
	if(abs(q.x) < 1. && abs(q.y) < 1.){i = color;}
}
void sunrise(vec2 p, inout vec3 i){
	float f = atan(p.y, p.x) + t;
	float fs = sin(f * 10.);
	i = mix(lightColor, backColor, fs);
}
void main(){
	vec2 p = (gl_FragCoord.xy * 2. - r) / min(r.x, r.y);
	vec3 destColor = vec3(1.);
	sunrise(p, destColor);
	float s = sin(sin(t * 2.) * .75);
	float c = cos(sin(t * 2.));
	vec2 q = p * mat2(c, -s, s, c);
	circle(q, vec2(0.), .5, faceColor, destColor);
	circle(q, vec2(0., -.05), .15, noseColor, destColor);
	circle(q, vec2(.325, -.05), .15, cheekColor, destColor);
	circle(q, vec2(-.325, -.05), .15, cheekColor, destColor);
	ellipse(q, vec2(.15, .135), vec2(.75, 1.), .075, eyesColor, destColor);
	ellipse(q, vec2(-.15, .135), vec2(.75, 1.), .075, eyesColor, destColor);
	circleLine(q, vec2(0.), .5, .525, lineColor, destColor);
	circleLine(q, vec2(0., -.05), .15, .17, lineColor, destColor);
	arcLine(q, vec2(.325, -.05), .15, .17, PI * 1.5, 0., lineColor, destColor);
	arcLine(q, vec2(-.325, -.05), .15, .17, PI * .5, 0., lineColor, destColor);
	arcLine(q * vec2(1.2, 1.), vec2(.19, .2), .125, .145, 0., .02, lineColor, destColor);
	arcLine(q * vec2(1.2, 1.), vec2(-.19, .2), .125, .145, 0., .02, lineColor, destColor);
	arcLine(q * vec2(.9, 1.), vec2(0., -.15), .2, .22, PI, .055, lineColor, destColor);
	rect(q, vec2(-.025, 0.), .035, highlight, destColor);
	rect(q, vec2(-.35, 0.), .035, highlight, destColor);
	rect(q, vec2(.3, 0.), .035, highlight, destColor);
	gl_FragColor = vec4(destColor, 1.);
}</script>
	<script id="003" type="x-shader/x-fragment">precision mediump float;
uniform vec2 r;
uniform float t;

#define F(A,B,C,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p) A=B>=C&&B<(C+16)?B==(C+0)?a:B==(C+1)?b:B==(C+2)?c:B==(C+3)?d:B==(C+4)?e:B==(C+5)?f:B==(C+6)?g:B==(C+7)?h:B==(C+8)?i:B==(C+9)?j:B==(C+10)?k:B==(C+11)?l:B==(C+12)?m:B==(C+13)?n:B==(C+14)?o:B==(C+15)?p:A:A

#define V vec3(1.0,0.8,0.8)
#define W vec3(0.5,0.0,0.0)
#define X vec3(1.0,0.0,0.0)
#define Y vec3(1.0,1.0,0.0)
#define Z vec3(0.0,0.0,1.0)
#define _ vec3(0.)

void main() {
	vec2 p = gl_FragCoord.xy/r.xy;
	vec3 m = vec3(0.0);
	float x = floor(p.x * 16.0);
	float y = floor((1.0 - p.y) * 16.0);
	int i = int(x + y * 16.0);
	
	F(m,i,  0,_,_,_,_,_,_,_,_,_,_,_,_,_,V,V,V);
	F(m,i, 16,_,_,_,_,_,_,X,X,X,X,X,_,_,V,V,V);
	F(m,i, 32,_,_,_,_,_,X,X,X,X,X,X,X,X,X,V,V);
	F(m,i, 48,_,_,_,_,_,W,W,W,V,V,W,V,_,X,X,X);
	F(m,i, 64,_,_,_,_,W,V,W,V,V,V,W,V,V,X,X,X);
	F(m,i, 80,_,_,_,_,W,V,W,W,V,V,V,W,V,V,V,X);
	F(m,i, 96,_,_,_,_,W,W,V,V,V,V,W,W,W,W,X,_);
	F(m,i,112,_,_,_,_,_,_,V,V,V,V,V,V,V,X,_,_);
	F(m,i,128,_,_,X,X,X,X,X,Z,X,X,X,Z,X,_,_,_);
	F(m,i,144,_,X,X,X,X,X,X,X,Z,X,X,X,Z,_,_,W);
	F(m,i,160,V,V,X,X,X,X,X,X,Z,Z,Z,Z,Z,_,_,W);
	F(m,i,176,V,V,V,_,Z,Z,X,Z,Z,Y,Z,Z,Y,Z,W,W);
	F(m,i,192,_,V,_,W,Z,Z,Z,Z,Z,Z,Z,Z,Z,Z,W,W);
	F(m,i,208,_,_,W,W,W,Z,Z,Z,Z,Z,Z,Z,Z,Z,W,W);
	F(m,i,224,_,W,W,W,Z,Z,Z,Z,Z,Z,Z,_,_,_,_,_);
	F(m,i,240,_,W,_,_,Z,Z,Z,Z,_,_,_,_,_,_,_,_);
	
	p = mod(p, 0.1) - 0.05;
	float s = sin(t);
	float c = cos(t);
	p *= mat2(c, s, -s, c);
	float v = 0.1 / abs(p.y) * abs(p.x);
	float r = v * abs(sin(t * 5.0) - 2.5) + 0.5;
	if (m.r < 0.1 && m.g < 0.1 && m.b < 0.1) {
		gl_FragColor = vec4(vec3(r), 1.0);
	} else {
		gl_FragColor = vec4(m, 1.0);
	}
}</script>
	<script id="004" type="x-shader/x-fragment">precision mediump float;
uniform float t; // time
uniform vec2  r; // resolution

float get( vec2 p )
{
	float c = 0.0;
	for(int i=0;i<10;i++)
	{
		float o = t+float(i)*100.0;
		vec2 q = vec2( sin(o*0.23), cos(o*0.31) );
		c += exp(length(q-p)*-3.0);
	}
	float r = clamp(log(c) * 10.0, 0.0, 1.57);
	return sin(r);
}

void main(void)
{
	vec2 p = (gl_FragCoord.xy * 2.0 - r) / min(r.x, r.y);
	float g = get(p);
	vec3 n = normalize(vec3( g - get(p+vec2(0.01, 0.0)), g - get(p+vec2(0.0, 0.01)), 0.3 ));
	p += n.xy * -0.2;
	float c = mod(floor(p.x * 12.0) + floor(p.y * 12.0 - t*0.5), 1.5) + 1.0;
	c *= n.z * 0.24;
	c += pow(abs(dot(n, vec3(0.7))), 80.0);
	vec3 col = vec3(1.0-g*0.2, 1.2-g*0.3, 1.7);
	gl_FragColor = vec4(col*pow(c, 1.0/2.2), 1.0);
}</script>
	<script id="005" type="x-shader/x-fragment">#define PI 3.14159265
precision mediump float;uniform float t;uniform vec2  r;
vec2 rot(vec2 p,float a){float c=cos(a),s=sin(a);return p*mat2(c,-s,s,c);}
bool xnor(bool a,bool b){return !(a^^b);}
bool alleq(bool a,bool b,bool c){return xnor(a,b)&&xnor(b,c)&&xnor(c,a);}
bool rect(vec2 p,vec2 wh){return abs(p.x)<abs(wh.x)&&abs(p.y)<abs(wh.y);}
bool cir(vec2 p,float r){return length(p)<r;}
bool tragl(vec2 p,vec2 a,vec2 b,vec2 c){return alleq(cross(vec3(b-a,0.),vec3(p-b,0.)).z<0.,cross(vec3(c-b,0.),vec3(p-c,0.)).z<0.,cross(vec3(a-c,0.),vec3(p-a,0.)).z<0.);}
bool digNF(vec2 p){return rect(p,vec2(.025,.075))||tragl(p,vec2(.025,.075),vec2(-.025,.075),vec2(.0,.1))||tragl(p,vec2(.025,-.075),vec2(-.025,-.075),vec2(.0,-.1));}
bool digN(vec2 p,int n){float D=.005;bool a=digNF(p-vec2(.1+D,.1+D)),b=digNF(p-vec2(.1+D,-.1-D)),c=digNF(p-vec2(-.1-D,.1+D)),d=digNF(p-vec2(-.1-D,-.1-D)),e=digNF(rot(p,PI/2.)),f=digNF(rot(p-vec2(0.,.2+2.*D),PI/2.)),g=digNF(rot(p+vec2(0.,.2+2.*D),PI/2.));if(n==0){return a||b||c||d||f||g;}if(n==1){return a||b;}if(n==2){return a||d||e||f||g;}if(n==3){return a||b||e||f||g;}if(n==4){return a||b||c||e;}if(n==5){return b||c||e||f||g;}if(n==6){return b||c||d||e||f||g;}if(n==7){return a||b||f;}if(n==8){return a||b||c||d||e||f||g;}if(n==9){return a||b||c||e||f||g;}return false;}
bool colon(vec2 p){return rect(p*3.-vec2(0.,.3),vec2(.1))||rect(p*3.-vec2(0.,-.3),vec2(.1));}
float calcAngInSec(){return(t/1.)*(PI/30.);}
float calcAngInMin(){return(t/60.)*(PI/30.);}
float calcAngInHor(){return(t/3600.)*(PI/6.);}
float getHrs(){return mod(floor(t/3600.),24.);}
float getMns(){return mod(floor(t/60.),60.);}
float getScs(){return mod(floor(t),60.);}
void main(){
	vec2 p=(gl_FragCoord.xy*2.-r)/min(r.x,r.y);
	float destC=cir(p,.9)^^cir(p,.85)?1.:0.;
	int plots=12;
	for(int i=0;i>=0;i++){
		destC+=(rect(rot(p,float(i)*(PI/float(plots/2)))-vec2(0.,.7),vec2(.015,.075)))?1.:0.;
		if(i>plots)break;
	}
	plots=60;
	for(int i=0;i>=0;i++){
		destC+=(rect(rot(p,float(i)*(PI/float(plots/2)))-vec2(0.,.75),vec2(.015,.02)))?1.:0.;
		if(i>plots)break;
	}
	destC+=cir(p,.02)?1.:0.;
	destC+=rect(rot(p,calcAngInSec())-vec2(.0,.35),vec2(.0075,.35))?1.:0.;
	destC+=rect(rot(p,calcAngInMin())-vec2(.0,.3),vec2(.01,.3))?1.:0.;
	destC+=rect(rot(p,calcAngInHor())-vec2(.0,.2),vec2(.01,.2))?1.:0.;

	float digT=0.;

	digT+=digN(p*3.-vec2(-1.2,-1.),int(getHrs()/10.))?1.:0.;
	digT+=digN(p*3.-vec2(-.8,-1.),int(mod(getHrs(),10.)))?1.:0.;
	digT+=colon(p*3.-vec2(-.5,-1.))?1.:0.;
	digT+=digN(p*3.-vec2(-.2,-1.),int(getMns()/10.))?1.:0.;
	digT+=digN(p*3.-vec2(.2,-1.),int(mod(getMns(),10.)))?1.:0.;
	digT+=colon(p*3.-vec2(.5,-1.))?1.:0.;
	digT+=digN(p*3.-vec2(.8,-1.),int(getScs()/10.))?1.:0.;
	digT+=digN(p*3.-vec2(1.2,-1.),int(mod(getScs(),10.)))?1.:0.;

	gl_FragColor=vec4(vec3(digT+destC),1.);
}</script>
	<script id="006" type="x-shader/x-fragment">precision mediump float;
uniform vec2 r;
uniform float t;

#define N normalize
#define F float
#define V vec3

V O=V(1.), Z=V(0.), sunDir, op[9], oc[9];
F os[9];
int x[17];

int raytrace(int mode, inout V org, inout V dir, out V hit, out V norm, out V col, out V dc)
{
	col = O; dc = Z;
	for(int re=0; re<3; re++) {
		int hi = -1;
		V c, h, n, diff;
		F minv = 1000.0, b, f, v;
		for(int i=0; i<6; i++) {
			diff = (op[i] - org);
			b = dot(diff, dir);
			f = max(0.0, b*b+os[i]*os[i]-dot(diff, diff));
			v = b - sqrt(f);
			if (v*f > 0.0) {
				if (mode>0) return 1;
				if ((v < minv) && (org.y + dir.y * v > 0.0)) {
					minv = v; hi = i;
					h = org + dir * (v+0.001);
					n = N( (h - op[i]) / os[i] );
					c = oc[i];
				}
			}
		}
		if (hi < 0) return 0;
		if (re == 0) { hit = h; norm = n; dc = c; }
		col *= c * (1.1+dot(dir,n));
		dir = N(reflect(dir,n));
		org = h;
	}
	return 0;
}

F map(vec2 p)
{
	F v=0.;
	int iy = int(mod(floor(p.x-1.5), 20.));
	for(int i=0; i<17; i++) if (i==iy) { v = F(x[i]); break; }
	return mod(floor(v*pow(0.5,mod(floor((p.y+0.5)*-1.2), 12.))), 2.);
}

V core(V org, V dir)
{
	V hit, norm, col, dc, q;
	raytrace( 0, org, dir, hit, norm, col, dc );
	if (dir.y >= 0.0) {
		F l = max(dot(dir, sunDir), 0.0);
		col *= V(pow(l, 99.9) * 50.0) + dir.y * V(0.01, 0.02, 0.03);
	} else {
		org -= org.y/dir.y*dir;
		if (raytrace(1, org, sunDir, q, q, q, q) > 0) col *= 0.1;
		float fc = mod(floor(0.05*org.x)+floor(0.1*org.z), 2.0);
		col *= clamp(0.4*fc, 0.1, -dir.y) * sunDir.y * (1.+map(org.xz));
	}
	if (dc.x > 0.0) {
		F nd = max(dot(norm, sunDir), 0.0);
		if (raytrace(1, hit, sunDir, q, q, q, q) > 0) nd = 0.0;
		col += dc*nd*0.1;
	}
	return col;
}

V flr( V org, V dir )
{
	V q, r = V(0.0);
	int dh = raytrace(1, org, dir, q, q, q, q);
	if ((dh == 0) && (dir.y < 0.0)) {
		org -= org.y/dir.y*dir;
		dir.y = -dir.y;
		r = core(org, dir);
	}
	return r;
}

void main() {
	x[0]=0x7c0;x[1]=0x10;x[2]=0x7d0;x[3]=0x19f;x[4]=0x7c0;x[5]=0x17;
	x[6]=0x55;x[7]=0x7dd;x[8]=0x40;x[9]=0x7;x[10]=0x7c4;x[11]=0x15f;
	x[12]=0x680;x[13]=0x1f;x[14]=0x384;x[15]=0x45b;x[16]=0x380;

	V sp = Z;
	sunDir = N(V(sin(t*0.7), 0.5, cos(t*0.3)));
	for(int i=0; i<6; i++)
	{
		F r = 0.9 * F(i) + t;
		F sr = sin(r*0.4), cr = cos(r*0.7);
		op[i] = V(sr, cr+1.4, sr*cr)*(sr+1.5)*12.0;
		os[i] = sr*3.+6.;
		oc[i] = pow(N(V(1.+cr, 1., 1.+sr)), V(2.2));
		sp += op[i];
	}
	vec2 s = (gl_FragCoord.xy*2.-r) / min(r.x, r.y);
	F cr = sin(t*0.1), st = sin(cr), ct = cos(cr);
	mat3 rmat = mat3(ct,0.,st,0.,1.,0.,-st,0.,ct);
	V org = sp/9. + rmat*V(0., 0., -40.);
	V ray = N(rmat*V(s, 1.));
	V col = core(org, ray) + flr(org, ray);
	gl_FragColor = vec4(pow(col,V(1.0/2.2)), 1.);
}</script>
</body>
</html>
